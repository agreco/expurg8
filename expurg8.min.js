!function(t,e,n){"use strict";function i(t){return"array"==D.ntype(t)}function r(t){return"boolean"==D.ntype(t)}function a(t){return"date"==D.ntype(t)&&!isNaN(+t)}function s(t){return"function"==D.ntype(t)}function o(t){return"number"==D.type(t)}function u(t){return"object"==D.ntype(t)}function c(t){return t instanceof L.Schema.Property}function l(t){return"regexp"==D.ntype(t)}function h(t){return"string"==D.ntype(t)}function p(t){return t instanceof L.Schema}function f(t){return t instanceof L.type.Object}function m(t){return"^"+e+"."+t}function d(){return!0}function g(t){return this.pattern.test(t)}function y(e,n){u(e)&&!n&&(n=e,e=n.classname,delete n.classname),u(n)||(n=D.obj());var i,r;return h(e)?(e=e.toLowerCase(),e.indexOf("[]")>0&&!(e in I.Class)&&(n.itemType=e.split("[")[0],e="collection"),i=I.Class[e]||t.get(e)||t.get(m(e)),i&&i.prototype instanceof L.Sanitizer||(r="{0}No Class found with name: {1}.")):r="{0}Invalid Class name. Expected the name of an existing {Name}.Sanitizer Class instead received: {1}",!r||b({classname:e,configuration:n,message:D.format(r,"{Name}.create: ",e)}),i?new i(n):null}function v(e,n){u(n)||b({descriptor:n,message:"Invalid Class definition",name:e}),n.module||(n.module=L),n.module===L&&(e=m(e));var r=n.alias;return delete n.alias,h(r)&&(r=r.split(" ")),i(r)||(r=[]),k(t.define(e,n),r)}function b(t,n){u(t)&&(n=t,t=n.type||"error",delete n.type),u(n)||(n={message:n}),h(n.message)&&(n.message=D.gsub(n.message,{Name:e})),s(n.trace)||(n.trace=b);var i=I.Class[(t+"").toLowerCase()]||b.Error;if(n=new i(n),!(n instanceof L.error.Warning))throw n;console.warn(n)}function x(t){return t instanceof L.Sanitizer?t:I.instance[(t+"").toLowerCase()]||null}function _(t){if(t instanceof L.Sanitizer)return t;switch(D.ntype(t)){case"string":return x(t=t.toLowerCase())||(t in I.Class?I.Class[t].create():y(t));case"object":return"classname"in t?y(t):null}return null}function w(t,e){return e=(e+"").toLowerCase(),!(e in I.Class)||b({classname:t[C],message:D.format("Cannot overwrite existing alias — {0}.",e)}),I.Class[e]=t}function j(t){if(h(t.id)){var e=t.id.toLowerCase();if(t instanceof L.Schema.Property){if(!h(Object.value(t,"schema.id")))return t;e=D.format("{0}:{1}",t.schema.id.toLowerCase(),e)}e in I.instance||(I.instance[e]=t)}return t}function k(t,e){return e.unshift(t[C]),e.reduce(w,t)}function E(t){if(h(t.id)){var e=t.id.toLowerCase();!(e in I.instance)||I.instance[e]!==t||delete I.instance[e]}return t}function S(t,e,n){this.schema=t,this.data=e,this.value=n||(i(raw)?[]:D.obj())}var O,T,C="__classname__",N="__properties__",M="__super__",A=Math.pow(2,32)-1,D=t.util,L=D.obj(),I={Class:D.obj(),instance:D.obj()},P=/[\r\n]+/gm;u(Object.value(n,e+".api"))?(T=n[e].api,delete n[e]):T=D.obj(),u(T.date)||(s(Date.coerce)?T.date={default_format:"c",between:function(t,e,n){return t.between(e,n)},coerce:function(t,e){return Date.coerce(t,e)},format:function(t,e){return t.format(e)}}:b("error","{Name}.api.date not detected, please supply an API for Date parsing and formatting or include the default: https://github.com/constantology/d8")),D.iter(n)||(n="commonjs"==D.ENV?module:D.global),u(Object.value(n,e+".api"))&&(T=n[e].api,delete n[e]),D.defs(L=D.expose(L,e,n),{MAX_ARRAY_LENGTH:A,api:{value:T},lib:{value:t},create:y,define:v,error:b,get:x,lookup:_},"w",!0),D.x(Object,Array,Boolean,Function),v("Sanitizer",function(){return{constructor:function(t){this.parent(arguments).test()||b("TypeError",{classname:this.constructor[C],configuration:t,instance:this,message:this.constructor[C]+": Invalid Configuration"}),j(this)},alias:null,id:null,coerce:function(t){return this.valid(t=this.value(t))?t:null},destroy:function(){E(this).parent(arguments)},valid:function(){return!0},test:function(){return this.valid()},value:function(t){return t}}}()),S.prototype={constructor:S,data:null,schema:null,value:null,valueOf:function(){return this.value}},v("Schema",function(){function t(t,e){switch(D.ntype(t)){case"function":if(c(t))break;if(!f(t)&&!p(t))return null;case"string":t={type:t};break;case"object":if("type"in t)break;return null}return"id"in t||(t.id=e),t}function e(e,n,i){var r=t(n,i);return null===r?b("warning",{classname:this.constructor[C],config:n,instance:this,message:"{Name}.Schema: Invalid Property Configuration"}):e.push(r),e}function n(e,n,i){var r=t(n,i);return null===r?b("warning",{Class:this,classname:this[C],config:n,message:"{Name}.Schema: Invalid Property Configuration"}):e[r.id]=r,e}return{afterdefine:function(t){var e=t[M],r=t.prototype.properties;delete t.prototype.properties,i(r)&&(r=r.reduce(n.bind(t),D.obj())),u(r)||(r=D.obj()),D.def(t,N,{value:u(e[N])?D.update(r,e[N]):r},"r",!0)},beforeinstance:function(t,r,a){var s=u(a[0])?a[0]:a[0]={properties:D.obj()};i(s.properties)&&(s.properties=s.properties.reduce(n.bind(t),D.obj())),u(s.properties)||(s.properties=D.obj()),!u(t[N])||D.update(s.properties,t[N]),s.properties=Object.reduce(s.properties,e.bind(this),[])},alias:"schema",extend:L.Sanitizer,cast:null,properties:null,coerce:function(t){return this.properties.reduce(this.aggregate,new S(this,t,this.value(t))).value},valid:function(t){return this.properties.every(this.validProperty,t)},aggregate:function(t,e){return e.coerce(t),t},init:function(){this.properties=this.properties.map(this.initProperty,this)},initProperty:function(t){return c(t)?t:y("property",D.copy(t,{schema:this}))},test:function(){return i(this.properties)&&!!this.properties.length&&this.properties.every(c)},validProperty:function(t){return t.valid(this)},value:function(t){switch(D.ntype(this.cast)){case"function":return this.cast();case"string":switch(this.cast){case"{}":return D.obj();case"[]":return[]}}return i(t)?[]:D.obj()}}}()),v("Schema.Property",{alias:"property",extend:L.Sanitizer,mixins:{minmax:e+".validation.MinMax"},_id:null,_path:null,cite:null,type:null,coerce:function(t){t instanceof S||b("typeerror",{classname:this.constructor[C],config:t,instance:this,message:D.format("{Name}.Schema.Property#coerce: expected instance of private Class — Accumulator — not: {0}",t)});var e=this.value(t.data);return e=this.hasMany?this.mixin("minmax",[e]):this.type.coerce(e),this.assign(t.value,e),t},valid:function(){return this.mixin("minmax",arguments)},assign:function(t,e){var n=i(this._path)?D.bless(this._path,t):t;return n[this._id]=e,t},init:function(){this.initType(this.type).initMappings(this.cite,this.id).mixin("minmax")},initMappings:function(t,e){if(h(t)||(t=e),this.cite=t,this.id=e,h(e)&&~e.indexOf(".")){var n=e.split(".");this._id=n.pop(),n.length&&(this._path=n)}else this._id=this.id},initType:function(t){var e,n=f(t)||p(t)?t:null;if(!n)switch(D.ntype(t)){case"string":n=_(t);break;case"object":"type"in t?(e=t.type,delete t.type,n=y(e,t)):n=y(t)}this.type=n},test:function(){return(f(this.type)||p(this.type))&&(h(this._id)||o(this._id))&&this.mixin("minmax")},value:function(t){return Object.value(t,this.cite)}}),v("type.Object",{alias:"{} auto mixed object",extend:L.Sanitizer,contingency:{get:function(){return s(this.fallback)?this.fallback():this.fallback},set:function(t){return console.warn(this.constructor[C]+": Over-writing `contingency` property is not allowed, please use the `fallback` property instead."),t}},fallback:null,coerce:function(t){return this.valid(t=this.value(t))?t:this.contingency},valid:function(t){return this.validType(t)},test:function(){return this.valid(this.contingency)},validType:function(t){return t!==O},value:function(t){return t===O?this.contingency:t}}),v("type.Boolean",{alias:"bool boolean",extend:L.type.Object,fallback:!1,validType:r,value:Boolean.coerce}),v("type.Number",{alias:"num number",extend:L.type.Object,fallback:0,max:Number.MAX_VALUE,min:-Number.MAX_VALUE,coerce:function(t){return t=this.value(t),t>this.max&&(t=this.max),t>this.min&&(t=this.min),this.parent(t)},valid:function(t){return this.parent(arguments)&&this.max>=t&&t>=this.min},init:function(){this.parent(),this.max=this.value(this.max),this.min=this.value(this.min)},test:function(){return this.valid(this.max)&&this.valid(this.min)&&this.parent()},validType:o,value:parseFloat}),v("type.Integer",{alias:"int integer",extend:L.type.Number,valid:function(t){return this.parent(arguments)&&Math.floor(t)===t},value:function(){return Math.round(this.parent(arguments))}}),v("type.Array",{alias:"[] array",extend:L.type.Object,max:A,min:0,coerce:function(t,e){return t=this.prune(this.value(t)),e===!0||this.valid(t)?t:this.contingency},valid:function(t){return this.parent(arguments)&&t.length<=this.max&&t.length>=this.min},fallback:function(){return[]},init:function(){this.parent(),this.max=this.max>>>0,this.min=this.min>>>0},prune:function(t){return t.length>this.max&&(t.length=this.max),t},test:function(){return o(this.max)&&o(this.min)&&A>=this.max&&this.min>=0&&this.max>=this.min&&this.parent()},validType:i,value:function(t){return this.validType(t)?t:Array.coerce(t)}}),v("type.Collection",{alias:"collection",extend:L.type.Array,itemType:"object",coerce:function(t){t=this.parent(t,!0);for(var e=-1,n=t.length;n>++e;)t[e]=this.coerceItem(t[e]);return this.valid(t)?t:this.contingency},valid:function(t){return this.parent(arguments)&&t.every(this.validItem,this)},coerceItem:function(t){return this.itemType.coerce(t)},init:function(){this.parent();var t=this.itemType;switch(D.ntype(t)){case"string":t=_(t);break;case"object":t instanceof L.Sanitizer||(t=y(t));break;default:t=null}D.def(this,"itemType",{value:t},"e",!0)},test:function(){return this.itemType instanceof L.Sanitizer&&this.parent()},validItem:function(t){return this.itemType.valid(t)}}),v("type.String",{alias:"str string",extend:L.type.Array,fallback:"",flags:null,pattern:null,trim:!0,valid:function(t){return this.parent(arguments)&&this.validStr(t)},init:function(){this.parent(),h(this.pattern)&&(this.pattern=RegExp(this.pattern,h(this.flags)?this.flags:"")),l(this.pattern)?this.validStr=g:this.pattern=null},prune:function(t){return t.length>this.max&&(t=t.substring(0,this.max)),t},validStr:d,validType:h,value:function(t){return t=h(t)?t:t+"",t=this.trim===!1?t:t.trim()}}),v("type.Enum",{alias:"enum",extend:L.type.Object,list:null,inverted:!1,valid:function(t){var e=!!~this.list.indexOf(t);return this.parent(arguments)&&(this.inverted===!0?!e:e)},fallback:function(){return this.list[0]},init:function(){this.parent(),h(this.list)&&(this.list=this.list.split(" "))},test:function(){return i(this.list)&&this.parent()}}),v("type.Date",{alias:"date",extend:L.type.Object,format:T.date.default_format,max:3250368e7,min:-621672192e5,coerce:function(t){return t=this.parent(arguments),+t>+this.max?new Date(+this.max):+this.min>+t?new Date(+this.min):t},valid:function(t){return this.parent(arguments)&&T.date.between(t,this.min,this.max)},fallback:function(){return new Date},init:function(){this.parent(),h(this.fallback)&&(this.fallback=this.value(this.fallback)),this.max=this.value(this.max),this.min=this.value(this.min)},test:function(){return this.valid(this.max)&&this.valid(this.min)&&this.parent()},validType:a,value:function(t){switch(D.ntype(t)){case"date":return t;case"number":return new Date(t);case"string":return T.date.coerce(t,this.format)}return this.contingency}}),v("error.Exception",{constructor:function(t){u(t)?(t.instance&&(t.classname=t.instance.constructor[C]),!s(Error.captureStackTrace)||Error.captureStackTrace(this,t.trace||this.constructor),delete t.trace,D.copy(this,t)):this.message=t+"",this.parent(this.constructor[C]+": "+this.message)},alias:"error exception",extend:Error,name:"Expurg8Exception",trace:{get:function(){return h(this.stack)?this.stack.split(P).invoke("trim"):[]}},toString:function(){return this.message}}),v("error.RangeException",{alias:"rangeerror rangeexception",extend:b.Exception,name:"Expurg8RangeException"}),v("error.TypeException",{alias:"typeerror typeexception",extend:b.Exception,name:"Expurg8TypeException"}),v("error.Warning",{alias:"warning",extend:b.Exception,name:"Expurg8Warning"})}("undefined"!=typeof id8?id8:"undefined"!=typeof require?require("id8"):null,"expurg8");
!function(t,e,i){"use strict";function n(t,e){return isNaN(t)?0/0:Math.round(parseFloat(t)*parseFloat("1e"+e))}function r(t,e){if(isNaN(t))return 0/0;var i=parseFloat(t)/parseFloat("1e"+e);return isNaN(i)||0===Math.abs(i)||0===e?i:parseFloat(i.toPrecision(e))}function a(t){return"array"==Y.ntype(t)}function s(t){return"boolean"==Y.ntype(t)}function c(t){return"date"==Y.ntype(t)&&!isNaN(+t)}function o(t){return"function"==Y.ntype(t)}function u(t){return h(t)&&Math.floor(t)===t}function h(t){return"number"==Y.type(t)}function l(t){return"object"==Y.ntype(t)}function p(t){return t instanceof G.Schema.Property}function f(t){return"regexp"==Y.ntype(t)}function m(t){return"string"==Y.ntype(t)}function d(t){return t instanceof G.Schema}function y(t){return t instanceof G.type.Object}function v(t){return"^"+e+"."+t}function g(){return!0}function b(t){return this.pattern.test(t)}function x(e,i){l(e)&&!i&&(i=e,e=i.classname,delete i.classname,!e&&i.type&&(e=i.type,delete i.type)),l(i)||(i=Y.obj());var n,r;return m(e)?(e=e.toLowerCase(),e.indexOf("[]")>0&&!(e in V.Class)&&(i.itemType=e.split("[")[0],e="collection"),n=V.Class[e]||t.get(e)||t.get(v(e)),n&&n.prototype instanceof G.Sanitizer||(r="{0}.create: No Class found with name: {1}.")):r="{0}.create: Invalid Class name. Expected the name of an existing {0}.Sanitizer Class instead received: {1}",!r||E({classname:e,configuration:i,message:Y.format(r,"{Name}",e)}),n?new n(i):null}function I(e,i){l(i)||E({descriptor:i,message:"Invalid Class definition",name:e}),i.module||(i.module=G),i.module===G&&(e=v(e)),m(i.extend)&&i.extend.toLowerCase()in V.Class&&(i.extend=V.Class[i.extend.toLowerCase()]);var n=i.alias;return delete i.alias,m(n)&&(n=n.split(" ")),a(n)||(n=[]),w(t.define(e,i),n)}function E(t,i){l(t)&&(i=t,t=i.type||"error",delete i.type),l(i)||(i={message:i}),m(i.message)&&(i.message=Y.gsub(i.message,{Name:e})),o(i.trace)||(i.trace=E);var n=V.Class[(t+"").toLowerCase()]||E.Error;if(i=new n(i),!(i instanceof G.error.Warning))throw i;console.warn(i)}function N(t){return t instanceof G.Sanitizer?t:V.instance[(t+"").toLowerCase()]||null}function T(t){if(t instanceof G.Sanitizer)return t;switch(Y.ntype(t)){case"string":return N(t=t.toLowerCase())||(t in V.Class?V.Class[t].create():x(t));case"object":return"classname"in t?x(t):null}return null}function C(t,e){return e=(e+"").toLowerCase(),!(e in V.Class)||E({classname:t[k],message:Y.format("Cannot overwrite existing alias â€” {0}.",e)}),V.Class[e]=t}function _(t){if(m(t.id)){var e=t.id.toLowerCase();if(t instanceof G.Schema.Property){if(!m(Object.value(t,"schema.id")))return t;e=Y.format("{0}:{1}",t.schema.id.toLowerCase(),e)}e in V.instance||(V.instance[e]=t)}return t}function w(t,i){var n=t[k];return i.unshift(n),0!==n.indexOf(e+".")||i.push(n.split(".").slice(1).join(".")),i.reduce(C,t)}function j(t){if(m(t.id)){var e=t.id.toLowerCase();!(e in V.instance)||V.instance[e]!==t||delete V.instance[e]}return t}function S(t,e,i){this.schema=t,this.data=e,this.value=i||(a(e)?[]:Y.obj())}var A,O,M,k="__classname__",R="__properties__",L="__super__",P=17,z=-1>>>0,D={ERROR:4,FALLBACK:1,WARN:2},F=Object.values(D),Y=t.util,G=Y.obj(),V={Class:Y.obj(),instance:Y.obj()},B=/[\r\n]+/gm;l(Object.value(i,e+".api"))?(M=i[e].api,delete i[e]):M=Y.obj(),l(M.date)||(o(Date.coerce)?M.date={default_format:"c",between:function(t,e,i){return t.between(e,i)},coerce:function(t,e){return Date.coerce(t,e)},format:function(t,e){return t.format(e)}}:E("error","{Name}.api.date not detected, please supply an API for Date parsing and formatting or include the default: https://github.com/constantology/d8")),Y.iter(i)||(i="commonjs"==Y.ENV?module:Y.global),Y.iter(i[e])&&(l(Object.value(i,e+".api"))&&(M=i[e].api),h(Object.value(i,e+".DECIMAL_PRECISION"))&&(P=i[e].DECIMAL_PRECISION),h(Object.value(i,e+".MAX_ARRAY_LENGTH"))&&(z=i[e].MAX_ARRAY_LENGTH),Object.value(i,e+".STRICT")&&(A=i[e].STRICT,A in D||~F.indexOf(A)||(A=D.FALLBACK)),delete i[e]),Y.defs(G=Y.expose(G,e,i),{DECIMAL_PRECISION:P,MAX_ARRAY_LENGTH:z,STRICT_MODE:{value:D},STRICT:A,api:{value:M},lib:{value:t},create:x,define:I,error:E,get:N,lookup:T},"w",!0),Y.x(Object,Array,Boolean,Function),I("Sanitizer",function(){return{constructor:function(t){this.parent(arguments).test()||E("TypeError",{configuration:t,instance:this,message:this.constructor[k]+(this.id?"#"+this.id:"")+": Invalid Configuration"}),_(this)},alias:null,id:null,strict:G.STRICT,coerce:function(t){return this.valid(t=this.value(t))?t:null},destroy:function(){j(this).parent(arguments)},sanitize:function(t){return t},valid:function(){return!0},test:function(){return this.valid()},value:function(t){return t}}}()),S.prototype={constructor:S,data:null,schema:null,value:null,valueOf:function(){return this.value}},I("Schema",function(){function t(t,e){switch(Y.ntype(t)){case"function":if(p(t))break;if(!y(t)&&!d(t))return null;case"string":t={type:t};break;case"object":if("type"in t)break;return null}return"id"in t||(t.id=e),t}function e(e,i,n){var r=t(i,n);return null===r?E("warning",{config:i,instance:this,message:"{Name}.Schema: Invalid Property Configuration"}):e.push(r),e}function i(e,i,n){var r=t(i,n);return null===r?E("warning",{Class:this,classname:this[k],config:i,message:"{Name}.Schema: Invalid Property Configuration"}):e[r.id]=r,e}return{afterdefine:function(t){var e=t[L],n=t.prototype.properties;delete t.prototype.properties,a(n)&&(n=n.reduce(i.bind(t),Y.obj())),l(n)||(n=Y.obj()),Y.def(t,R,{value:l(e[R])?Y.merge(Y.merge(e[R]),n):n},"r",!0)},beforeinstance:function(t,n,r){var s=l(r[0])?r[0]:r[0]={properties:Y.obj()},c=s.properties;a(c)&&(c=c.reduce(i.bind(t),Y.obj())),l(c)||(c=Y.obj()),l(t[R])&&(c=Y.merge(Y.merge(t[R]),c)),s.properties=Object.reduce(c,e.bind(this),[])},extend:G.Sanitizer,attribute:null,cast:null,properties:null,sanitizeProperty_:null,coerce:function(t){var e=D,i=this.strict,n=this.sanitize(this.accumulator(t)).value;return i===e.FALLBACK||this.valid(n)||E(i===e.ERROR?"error":"warning",{data:t,value:n,instance:this,message:this.constructor[k]+": Invalid coercion."}),n},sanitize:function(t){return this.properties.reduce(this.sanitizeProperty_,t)},valid:function(t){return this.properties.every(this.validProperty.bind(this,t))},accumulator:function(t){return new S(this,t,this.value(t))},init:function(){this.attribute=Y.obj(),this.properties=this.properties.map(this.initProperty,this),Y.def(this,"sanitizeProperty_",this.sanitizeProperty.bind(this),"w",!0),this.parent()},initProperty:function(t){var e=p(t)?t:x("property",Y.copy(t,{schema:this}));return this.attribute[e.id]=e},sanitizeProperty:function(t,e){return e.sanitize(t)},test:function(){return a(this.properties)&&!!this.properties.length&&this.properties.every(p)},validProperty:function(t,e){return e.valid(t)},value:function(t){switch(Y.ntype(this.cast)){case"function":return this.cast();case"string":switch(this.cast){case"{}":return Y.obj();case"[]":return[]}}return a(t)?[]:Y.obj()}}}()),I("validation.MinMax",{alias:"minmax",hasMany:!1,max:1,min:0,coerce:function(t){return this.prune(t.map(this.type.coerce,this.type))},valid:function(i){return this.hasMany?a(i)&&i.length>=this.min&&i.length<=this.max:!a(i)||t.is(this.type,e+".type.Array")&&!t.is(this.type,e+".type.String")},init:function(){this.max=this.max>>>0,this.min=this.min>>>0,this.hasMany=this.max>1},prune:function(t){return t.length>this.max&&(t.length=this.max),t},test:function(){return h(this.max)&&h(this.min)&&this.max>=this.min&&this.min>=0}}),I("Schema.Property",{alias:"property",extend:G.Sanitizer,mixins:{minmax:e+".validation.MinMax"},_id:null,_path:null,cite:null,type:null,coerce:function(t){return this.type.coerce(t)},sanitize:function(t){var e=this.value(t.data);return e=this.hasMany?this.$mx.minmax.coerce.call(this,e):this.coerce(e),this.assign(t.value,e),t},valid:function(t){var e=Object.value(t,this.id);return this.mixin("minmax",[e])&&(this.hasMany?e.every(this.type.valid,this):this.type.valid(e))},assign:function(t,e){var i=this._path?Y.bless(this._path,t):t;return i[this._id]=e,t},init:function(){this.initMappings(this.cite,this.id).initType(this.type).parent().mixin("minmax")},initMappings:function(t,e){if(m(t)||h(t)||(t=e),this.cite=t,this.id=e,m(e)&&~e.indexOf(".")){var i=e.split(".");this._id=i.pop(),i.length&&(this._path=i.join("."))}else this._id=this.id},initType:function(t){var e,i=y(t)||d(t)?t:null;if(!i)switch(Y.ntype(t)){case"string":i=T(t);break;case"object":"type"in t?(e=t.type,delete t.type,i=x(e,t)):i=x(t)}this.type=i},test:function(){return(y(this.type)||d(this.type))&&(m(this._id)||h(this._id))&&this.mixin("minmax")},value:function(t){var e=Object.value(t,this.cite);return this.hasMany?a(e)?e:[e]:e}}),I("type.Object",{alias:"{} auto mixed object",extend:G.Sanitizer,contingency:{get:function(){return o(this.fallback)?this.fallback():this.fallback},set:function(t){return E("warning",{instance:this,message:this.constructor[k]+": Over-writing `contingency` property is not allowed, please use the `fallback` property instead."}),t}},fallback:null,coerce:function(t){return this.valid(t=this.value(t))?t:this.contingency},stringify:function(t){return JSON.stringify(this.coerce(t))},valid:function(t){return this.validType(t)},test:function(){return this.valid(this.contingency)},validType:function(t){return t!==O},value:function(t){return t===O?this.contingency:t}}),I("type.Boolean",{alias:"bool boolean",extend:G.type.Object,fallback:!1,validType:s,value:Boolean.coerce}),I("type.Number",{alias:"num number",extend:G.type.Object,fallback:0,max:Number.POSITIVE_INFINITY,min:Number.NEGATIVE_INFINITY,precision:G.DECIMAL_PRECISION,coerce:function(t){return t=this.value(t),t>this.max&&(t=this.max),this.min>t&&(t=this.min),this.valid(t,!0)?r(t,this.precision):this.contingency},valid:function(t,e){if(!h(t))return!1;var i=e===!0?t:n(t,this.precision);return this.parent(arguments)&&this.max>=i&&i>=this.min&&(e===!0||r(i,this.precision)===t)},init:function(){switch(this.parent(),h(this.precision)||(this.precision=G.DECIMAL_PRECISION),this.precision=Math.abs(Math.round(this.precision)),Y.ntype(this.fallback)){case"function":break;default:this.fallback=r(this.value(this.fallback),this.precision)}this.max!==Number.POSITIVE_INFINITY&&(this.max=this.value(this.max)),this.min!==Number.NEGATIVE_INFINITY&&(this.min=this.value(this.min))},test:function(){return this.valid(this.max,!0)&&this.valid(this.min,!0)&&u(this.precision)&&this.precision<=G.DECIMAL_PRECISION&&Math.abs(this.precision)===this.precision&&this.parent()},validType:h,value:function(t){return n(t,this.precision)}}),I("type.Integer",{alias:"int integer",extend:G.type.Number,precision:0,valid:function(t){return this.parent(t,!0)&&Math.floor(t)===t},init:function(){var t=this.max,e=this.min;this.precision=0,this.parent(arguments),t!==Number.POSITIVE_INFINITY&&(this.max=t),e!==Number.NEGATIVE_INFINITY&&(this.min=e)},value:function(){return Math.round(this.parent(arguments))}}),I("type.Array",{alias:"[] array",extend:G.type.Object,max:G.MAX_ARRAY_LENGTH,min:0,coerce:function(t,e){return t=this.prune(this.value(t)),e===!0||this.valid(t)?t:this.contingency},valid:function(t){return this.parent(arguments)&&t.length<=this.max&&t.length>=this.min},fallback:function(){return[]},init:function(){this.parent(),this.max=this.max>>>0,this.min=this.min>>>0},prune:function(t){if(this.validType(t)&&(t.length>this.max&&(t.length=this.max),t.length<this.min)){var e=this.contingency.slice(0,this.min-t.length);t.push.apply(t,e)}return t},test:function(){return u(this.max)&&u(this.min)&&this.max<=G.MAX_ARRAY_LENGTH&&this.min>=0&&this.max>=this.min&&this.parent()},validType:a,value:function(t){return this.validType(t)?t:Array.coerce(t)}}),I("type.Collection",{alias:"collection",extend:G.type.Array,itemType:null,coerce:function(t){t=this.parent(t,!0);for(var e=-1,i=t.length;i>++e;)t[e]=this.coerceItem(t[e]);return this.valid(t)?t:this.contingency},valid:function(t){return this.parent(arguments)&&t.every(this.validItem,this)},coerceItem:function(t){return this.itemType.coerce(t)},init:function(){this.parent();var t=this.itemType;switch(Y.ntype(t)){case"string":t=T(t);break;case"object":t instanceof G.Sanitizer||(t=x(t));break;default:t=null}Y.def(this,"itemType",{value:t},"e",!0)},test:function(){return this.itemType instanceof G.Sanitizer&&this.parent()},validItem:function(t){return this.itemType.valid(t)}}),I("type.String",{alias:"str string",extend:G.type.Array,fallback:"",flags:null,pattern:null,trim:!0,valid:function(t){return this.parent(arguments)&&(0===t.length&&0===this.min||this.validStr(t))},init:function(){this.parent(),m(this.pattern)&&(this.pattern=RegExp(this.pattern,m(this.flags)?this.flags:"")),f(this.pattern)?this.validStr=b:this.pattern=null},prune:function(t){return this.validType(t)&&(t.length>this.max&&(t=t.substring(0,this.max)),t.length<this.min&&(t+=this.contingency.substring(0,this.min-t.length))),t},validStr:g,validType:m,value:function(t){switch(Y.ntype(t)){case"string":break;case"null":case"undefined":return this.contingency;default:if(Y.tostr(t)===""+t)return this.contingency;t=""+t}return t=this.trim===!1?t:t.trim()}}),I("type.Enum",{alias:"enum",extend:G.type.Object,list:null,inverted:!1,valid:function(t){var e=!!~this.list.indexOf(t);return this.parent(arguments)&&(this.inverted===!0?!e:e)},fallback:function(){return this.list[0]},init:function(){this.parent(),m(this.list)&&(this.list=this.list.split(" "))},test:function(){return a(this.list)&&this.parent()}}),I("type.Date",{alias:"date",extend:G.type.Object,format:G.api.date.default_format,max:3250368e7,min:-621672192e5,coerce:function(t){return t=this.parent(arguments),+t>+this.max?new Date(+this.max):+this.min>+t?new Date(+this.min):t},stringify:function(t){return G.api.date.format(this.coerce(t),this.format)},valid:function(t){return this.parent(arguments)&&G.api.date.between(t,this.min,this.max)},fallback:function(){return new Date},init:function(){this.parent(),m(this.fallback)&&(this.fallback=this.value(this.fallback)),this.max=this.value(this.max),this.min=this.value(this.min)},test:function(){return this.valid(this.max)&&this.valid(this.min)&&this.parent()},validType:c,value:function(t){switch(Y.ntype(t)){case"date":return t;case"number":return new Date(t);case"string":return G.api.date.coerce(t,this.format)}return this.contingency}}),I("error.Exception",{constructor:function(t){l(t)?(t.instance&&(t.classname=t.instance.constructor[k]),!o(Error.captureStackTrace)||Error.captureStackTrace(this,t.trace||this.constructor),delete t.trace,Y.copy(this,t)):this.message=t+"",this.parent(this.constructor[k]+": "+this.message)},alias:"error exception",extend:Error,name:"Expurg8Exception",trace:{get:function(){return m(this.stack)?this.stack.split(B).invoke("trim"):[]}},toString:function(){return this.message}}),I("error.RangeException",{alias:"rangeerror rangeexception",extend:E.Exception,name:"Expurg8RangeException"}),I("error.TypeException",{alias:"typeerror typeexception",extend:E.Exception,name:"Expurg8TypeException"}),I("error.Warning",{alias:"warning",extend:E.Exception,name:"Expurg8Warning"})}("undefined"!=typeof id8?id8:"undefined"!=typeof require?require("id8"):null,"expurg8");